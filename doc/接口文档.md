# ç½‘ä¸Šèœè°±åˆ†äº«å¹³å° API æ¥å£æ±‡æ€»æ–‡æ¡£

## ğŸ“‹ æ¥å£æ¦‚è§ˆ

æœ¬æ–‡æ¡£æ±‡æ€»äº†ç½‘ä¸Šèœè°±åˆ†äº«å¹³å°é¡¹ç›®çš„æ‰€æœ‰ REST API æ¥å£ã€‚

## ğŸ” è®¤è¯è¯´æ˜

é™¤æ¸¸å®¢å¯è®¿é—®çš„å…¬å…±æ¥å£å¤–ï¼Œå…¶ä»–æ¥å£éœ€è¦æºå¸¦ JWT Token è¿›è¡Œè®¤è¯ï¼š

```http
Authorization: Bearer <your-jwt-token>
```

## ğŸ“¡ ç»Ÿä¸€å“åº”æ ¼å¼

```JSON
{
  "code": 200,
  "message": "success",
  "data": {}
}
```

## 1ï¸âƒ£ ç”¨æˆ·è´¦å·ä¸ä¸ªäººä¸­å¿ƒ API

**Base Path**: `/api/v1/users`

| **æ–¹æ³•** | **è·¯å¾„**    | **åŠŸèƒ½**         | **æ˜¯å¦éœ€è¦è®¤è¯** |
| -------- | ----------- | ---------------- | ---------------- |
| POST     | `/register` | ç”¨æˆ·æ³¨å†Œ         | âŒ                |
| POST     | `/login`    | ç”¨æˆ·ç™»å½•         | âŒ                |
| GET      | `/me`       | è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ | âœ…                |
| PUT      | `/me`       | ä¿®æ”¹ä¸ªäººèµ„æ–™     | âœ…                |
| PUT      | `/password` | ä¿®æ”¹ç™»å½•å¯†ç      | âœ…                |
| POST     | `/logout`   | é€€å‡ºç™»å½•         | âœ…                |

### 1.1 ç”¨æˆ·æ³¨å†Œ

```HTTP
POST /api/v1/users/register
Content-Type: application/json

{
  "username": "chef_wang",
  "password": "password123",
  "nickname": "ç‹å¤§å¨",
  "avatar": "http://img.example.com/default.png"
}
```

### 1.2 ç”¨æˆ·ç™»å½•

```HTTP
POST /api/v1/users/login
Content-Type: application/json

{
  "username": "chef_wang",
  "password": "password123"
}

Response:
{
  "code": 200,
  "message": "success",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIs...",
    "userId": 1001,
    "nickname": "ç‹å¤§å¨",
    "role": "member" 
  }
}
```

### 1.3 ä¿®æ”¹ä¸ªäººèµ„æ–™

```HTTP
PUT /api/v1/users/me
Authorization: Bearer <token>
Content-Type: application/json

{
  "nickname": "ç‰¹çº§å¨å¸ˆå°ç‹",
  "avatar": "http://img.example.com/new_avatar.png",
  "intro": "ä¸“æ³¨å·èœäºŒåå¹´"
}
```

## 2ï¸âƒ£ èœè°±å…¬å…±æ¨¡å— API (æµè§ˆä¸æœç´¢)

**Base Path**: `/api/v1/recipes`

| **æ–¹æ³•** | **è·¯å¾„**  | **åŠŸèƒ½**          | **æ˜¯å¦éœ€è¦è®¤è¯** |
| -------- | --------- | ----------------- | ---------------- |
| GET      | `/list`   | é¦–é¡µèœè°±åˆ—è¡¨/ç­›é€‰ | âŒ                |
| GET      | `/search` | å…³é”®å­—æœç´¢        | âŒ                |
| GET      | `/{id}`   | è·å–èœè°±è¯¦æƒ…      | âŒ                |

### 2.1 èœè°±åˆ—è¡¨ä¸ç­›é€‰

æ”¯æŒæŒ‰åˆ†ç±»ç­›é€‰ï¼ˆç”œå“ã€ç´ èœã€è‚‰ç±»ç­‰ï¼‰ã€‚

```HTTP
GET /api/v1/recipes/list?categoryId=1&page=1&size=10
Content-Type: application/json

Response:
{
  "code": 200,
  "data": {
    "total": 50,
    "list": [
      {
        "id": 101,
        "title": "éº»å©†è±†è…",
        "coverImage": "http://img.example.com/mapo.jpg",
        "authorName": "ç‹å¤§å¨",
        "viewCount": 1200
      }
    ]
  }
}
```

### 2.2 èœè°±è¯¦æƒ…

```HTTP
GET /api/v1/recipes/101
Content-Type: application/json

Response:
{
  "code": 200,
  "data": {
    "id": 101,
    "title": "éº»å©†è±†è…",
    "coverImage": "http://...",
    "description": "æ­£å®—å·å‘³...",
    "author": {
      "id": 1001,
      "nickname": "ç‹å¤§å¨",
      "avatar": "http://..."
    },
    "ingredients": [
      {"name": "è±†è…", "amount": "500g"},
      {"name": "è‚‰æœ«", "amount": "100g"}
    ],
    "steps": [
      {"stepNo": 1, "desc": "è±†è…åˆ‡å—", "img": "http://..."},
      {"stepNo": 2, "desc": "ä¸‹é”…ç„¯æ°´", "img": "http://..."}
    ],
    "status": 1, 
    "publishTime": "2025-12-15T10:00:00"
  }
}
```

## 3ï¸âƒ£ èœè°±å‘å¸ƒä¸ç®¡ç† API (æ ¸å¿ƒä¸šåŠ¡)

**Base Path**: `/api/v1/my/recipes`

> [!IMPORTANT]
>
> æ¶‰åŠçŠ¶æ€æµè½¬é€»è¾‘ã€‚
>
> status: 0-å¾…å®¡æ ¸, 1-å®¡æ ¸é€šè¿‡(å·²å‘å¸ƒ), 2-å®¡æ ¸å¤±è´¥ã€‚

| **æ–¹æ³•** | **è·¯å¾„** | **åŠŸèƒ½**     | **è¯´æ˜**            |
| -------- | -------- | ------------ | ------------------- |
| POST     | `/`      | å‘å¸ƒèœè°±     | åˆå§‹çŠ¶æ€ä¸º 0        |
| PUT      | `/`      | ä¿®æ”¹èœè°±     | ä»…é™çŠ¶æ€ 0 æˆ– 2     |
| DELETE   | `/{id}`  | åˆ é™¤èœè°±     |                     |
| GET      | `/`      | æˆ‘çš„å‘å¸ƒåˆ—è¡¨ | æ”¯æŒæŒ‰æ—¶é—´/åç§°ç­›é€‰ |

### 3.1 å‘å¸ƒèœè°±

```HTTP
POST /api/v1/my/recipes
Authorization: Bearer <token>
Content-Type: application/json

{
  "title": "çº¢çƒ§è‚‰",
  "categoryId": 3,
  "coverImage": "http://img.example.com/pork.jpg",
  "ingredients": [{"name": "äº”èŠ±è‚‰", "amount": "500g"}],
  "steps": [{"stepNo": 1, "desc": "ç„¯æ°´", "img": "http://..."}]
}
```

### 3.2 ä¿®æ”¹èœè°±

```HTTP
PUT /api/v1/my/recipes
Authorization: Bearer <token>
Content-Type: application/json

{
  "id": 205,
  "title": "çº¢çƒ§è‚‰ï¼ˆæ”¹è¿›ç‰ˆï¼‰",
  "steps": [...]
}
```

> [!WARNING]
>
> ç¼–è¾‘æƒé™æ§åˆ¶
>
> åç«¯ä¼šæ ¡éªŒå½“å‰èœè°±çŠ¶æ€ï¼š
>
> - è‹¥ `status == 1` (å·²å‘å¸ƒ)ï¼Œæ¥å£è¿”å› 403 é”™è¯¯ï¼Œç¦æ­¢ä¿®æ”¹ã€‚
> - è‹¥ `status == 0` (å¾…å®¡æ ¸) æˆ– `2` (å®¡æ ¸é©³å›)ï¼Œå…è®¸ä¿®æ”¹ï¼Œä¿®æ”¹åçŠ¶æ€é‡ç½®ä¸º `0` (å¾…å®¡æ ¸)ã€‚

### 3.3 æˆ‘çš„å‘å¸ƒåˆ—è¡¨

```HTTP
GET /api/v1/my/recipes?keyword=çº¢çƒ§&sort=time_desc
Authorization: Bearer <token>

Response:
{
  "code": 200,
  "data": [
    {
      "id": 205,
      "title": "çº¢çƒ§è‚‰",
      "status": 2, // å®¡æ ¸å¤±è´¥
      "rejectReason": "å›¾ç‰‡æ¨¡ç³Š", // ä»…å¤±è´¥æ—¶æœ‰æ­¤å­—æ®µ
      "createTime": "2025-12-16T10:00:00"
    },
    {
      "id": 204,
      "title": "æ¸…è’¸é±¼",
      "status": 1, // å·²å‘å¸ƒ
      "createTime": "2025-12-15T10:00:00"
    }
  ]
}
```

## 4ï¸âƒ£ äº’åŠ¨åŠŸèƒ½ API (æ”¶è—/è¯„è®º)

**Base Path**: `/api/v1/interactions`

| **æ–¹æ³•** | **è·¯å¾„**                | **åŠŸèƒ½**     |
| -------- | ----------------------- | ------------ |
| POST     | `/favorites/{recipeId}` | æ”¶è—èœè°±     |
| DELETE   | `/favorites/{recipeId}` | å–æ¶ˆæ”¶è—     |
| GET      | `/favorites`            | æˆ‘çš„æ”¶è—åˆ—è¡¨ |
| POST     | `/comments`             | å‘è¡¨è¯„è®º     |
| DELETE   | `/comments/{commentId}` | åˆ é™¤è¯„è®º     |
| GET      | `/comments/my`          | æˆ‘çš„è¯„è®ºåˆ—è¡¨ |

### 4.1 æ”¶è—èœè°±

```HTTP
POST /api/v1/interactions/favorites/101
Authorization: Bearer <token>

Response:
{
  "code": 200,
  "message": "æ”¶è—æˆåŠŸ"
}
```

### 4.2 å‘è¡¨è¯„è®º

```HTTP
POST /api/v1/interactions/comments
Authorization: Bearer <token>
Content-Type: application/json

{
  "recipeId": 101,
  "content": "çœ‹èµ·æ¥å¾ˆå¥½åƒï¼Œå‘¨æœ«è¯•è¯•ï¼"
}
```

## 5ï¸âƒ£ ç¤¾äº¤åŠŸèƒ½ API (å…³æ³¨/ç§ä¿¡)

**Base Path**: `/api/v1/social`

| **æ–¹æ³•** | **è·¯å¾„**             | **åŠŸèƒ½**     |
| -------- | -------------------- | ------------ |
| POST     | `/follows/{userId}`  | å…³æ³¨ç”¨æˆ·     |
| DELETE   | `/follows/{userId}`  | å–æ¶ˆå…³æ³¨     |
| GET      | `/follows`           | æˆ‘çš„å…³æ³¨åˆ—è¡¨ |
| POST     | `/messages`          | å‘é€ç§ä¿¡     |
| GET      | `/messages/{userId}` | è·å–èŠå¤©è®°å½• |

### 5.1 å…³æ³¨ç”¨æˆ·

```HTTP
POST /api/v1/social/follows/1001
Authorization: Bearer <token>
```

### 5.2 å‘é€ç§ä¿¡

> [!NOTE]
>
> å‰ç½®æ¡ä»¶: å‰ç«¯éœ€æ ¡éªŒï¼Œé€šå¸¸å¿…é¡»åœ¨â€œæˆ‘çš„å…³æ³¨â€åˆ—è¡¨ä¸­æ‰å¯å‘èµ·ç§èŠï¼ˆæˆ–æ ¹æ®ä¸šåŠ¡é€»è¾‘ï¼Œå¦‚æœæ˜¯å…³æ³¨äº†å³å¯èŠï¼‰ã€‚

```HTTP
POST /api/v1/social/messages
Authorization: Bearer <token>
Content-Type: application/json

{
  "receiverId": 1001,
  "content": "å¤§å¨ï¼Œè¯·é—®é‚£ä¸ªé…±æ²¹ç”¨ç”ŸæŠ½è¿˜æ˜¯è€æŠ½ï¼Ÿ"
}
```

### 5.3 è·å–ä¸æŸäººçš„èŠå¤©è®°å½•

```HTTP
GET /api/v1/social/messages/1001?page=1
Authorization: Bearer <token>

Response:
{
  "code": 200,
  "data": [
    {
      "id": 55,
      "senderId": 1002, // æˆ‘
      "content": "ä½ å¥½",
      "time": "..."
    },
    {
      "id": 56,
      "senderId": 1001, // å¯¹æ–¹
      "content": "ä½ å¥½å‘€",
      "time": "..."
    }
  ]
}
```

## 6ï¸âƒ£ åå°ç®¡ç† API (ç®¡ç†å‘˜)

**Base Path**: `/api/v1/admin`

> [!WARNING]
>
> æ­¤æ¨¡å—æ¥å£éœ€è¦éªŒè¯ç®¡ç†å‘˜æƒé™ (Role=Admin)ã€‚

| **æ–¹æ³•** | **è·¯å¾„**                 | **åŠŸèƒ½**                |
| -------- | ------------------------ | ----------------------- |
| GET      | `/users`                 | ç”¨æˆ·åˆ—è¡¨(ç®¡ç†/å°ç¦)     |
| PUT      | `/users/{userId}/status` | ä¿®æ”¹ç”¨æˆ·çŠ¶æ€(æ­£å¸¸/å°ç¦) |
| GET      | `/recipes/audit`         | å¾…å®¡æ ¸èœè°±åˆ—è¡¨          |
| POST     | `/recipes/audit`         | å®¡æ ¸èœè°±(é€šè¿‡/é©³å›)     |
| POST     | `/categories`            | æ–°å¢åˆ†ç±»                |
| DELETE   | `/categories/{id}`       | åˆ é™¤åˆ†ç±»                |

### 6.1 å®¡æ ¸èœè°±æ“ä½œ

```HTTP
POST /api/v1/admin/recipes/audit
Authorization: Bearer <admin-token>
Content-Type: application/json

{
  "recipeId": 205,
  "action": "reject", // pass æˆ– reject
  "reason": "å›¾ç‰‡æ¶‰å«Œè¿è§„ï¼Œè¯·ä¿®æ”¹" // ä»… reject æ—¶å¿…å¡«
}

Response:
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ"
}
```

### 6.2 åˆ†ç±»ç®¡ç†

```HTTP
POST /api/v1/admin/categories
Authorization: Bearer <admin-token>
Content-Type: application/json

{
  "name": "ç©ºæ°”ç‚¸é”…ç¾é£Ÿ",
  "sortOrder": 5
}
```

## ğŸ” é”™è¯¯ç è¯´æ˜

| **é”™è¯¯ç ** | **è¯´æ˜**                  |
| ---------- | ------------------------- |
| 200        | æˆåŠŸ                      |
| 400        | å‚æ•°é”™è¯¯                  |
| 401        | Tokenæ— æ•ˆæˆ–è¿‡æœŸ           |
| 403        | æ— æƒé™ (å¦‚ä¿®æ”¹å·²å‘å¸ƒèœè°±) |
| 404        | èµ„æºä¸å­˜åœ¨                |
| 500        | ç³»ç»Ÿå†…éƒ¨é”™è¯¯              |