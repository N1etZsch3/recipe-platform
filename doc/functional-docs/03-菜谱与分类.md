# 菜谱与分类

本模块覆盖菜谱生命周期、分类、查询与用户侧编辑能力。

## 1. 状态与流转

- 状态定义：
  - `0` 待审核（pending）
  - `1` 已发布（published）
  - `2` 驳回（rejected）
- 规则：
  - 已发布菜谱不可直接修改。
  - 待审核/驳回菜谱允许修改，修改后重新进入待审核。
  - 已发布菜谱可通过“下架”进入待审核状态后再编辑。

## 2. 公开查询接口（游客可用）

- `GET /api/v1/recipes/categories`
  - 返回分类列表，按 `sortOrder` 与 `id` 升序。
- `GET /api/v1/recipes/list`
  - 分页查询菜谱，支持 `page`/`size`/`categoryId`/`keyword`/`sort`/`authorId`/`status`。
  - 未指定 `status` 且未指定 `authorId` 时，默认只返回已发布菜谱。
- `GET /api/v1/recipes/{id}`
  - 返回菜谱详情与作者信息、食材、步骤。
  - 阅读一次会累加浏览量。

## 3. 简化版发布/编辑（前端简化表单）

- `POST /api/v1/recipes`
  - 简化版菜谱发布（`SimpleRecipeDTO`）。
  - 具备幂等与限流能力。
- `PUT /api/v1/recipes`
  - 简化版菜谱更新（`SimpleRecipeDTO`）。
- `POST /api/v1/recipes/{id}/unpublish`
  - 将已发布菜谱下架为待审核状态。

## 4. 完整发布/编辑/删除（我的菜谱）

- `POST /api/v1/my/recipes`
  - 完整菜谱发布（`RecipePublishDTO`，含食材与步骤）。
- `PUT /api/v1/my/recipes`
  - 完整菜谱修改（重新进入待审核）。
- `DELETE /api/v1/my/recipes/{id}`
  - 删除菜谱（同时删除食材/步骤）。

## 5. 关键字段说明

- `RecipePublishDTO`
  - `title`：标题（必填）
  - `categoryId`：分类 ID（必填）
  - `ingredients` / `steps`：食材与步骤（必填）
- `SimpleRecipeDTO`
  - `title` / `content` / `coverImage` / `category`（分类名称，会转换为 `categoryId`）

## 6. 行为细节与约束

- 发布与修改：仅作者可操作。
- 修改后状态变更为待审核。
- 删除为逻辑删除（按当前实现为物理删除），并清理关联表。
- 详情页对登录用户返回 `isFavorite`/`isFollow` 状态。
