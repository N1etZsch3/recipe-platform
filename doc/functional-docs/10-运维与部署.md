# 运维与部署

本文件描述后端与前端的运行依赖、环境变量、初始化与常见问题。

## 1. 依赖环境

- JDK 21
- Maven 3.9+
- Node.js 18+（前端）
- MySQL 8.0
- Redis 7.x
- Tencent COS（可选，启用上传功能时必需）

## 2. 数据库初始化

- 初始化脚本：`sql/recipe-platform-sql.sql`
- 默认数据库名：`recipe_platform`

建议执行顺序：
1. 创建数据库并导入脚本。
2. 配置数据库连接环境变量。

## 3. 环境变量（.env）

后端启动时读取 `.env` 并写入系统属性：

| 变量 | 说明 | 示例 |
| --- | --- | --- |
| DB_URL | MySQL 连接串 | `jdbc:mysql://localhost:3306/recipe_platform?useSSL=false&serverTimezone=UTC` |
| DB_USERNAME | 数据库用户名 | `root` |
| DB_PASSWORD | 数据库密码 | `password` |
| REDIS_HOST | Redis 主机 | `127.0.0.1` |
| REDIS_PORT | Redis 端口 | `6379` |
| REDIS_PASSWORD | Redis 密码 | `your_password` |
| REDIS_DB | Redis DB | `0` |
| JWT_SECRET | JWT 密钥 | `your-secret` |
| COS_SECRET_ID | COS SecretId | `xxx` |
| COS_SECRET_KEY | COS SecretKey | `xxx` |
| COS_REGION | COS 区域 | `ap-guangzhou` |
| COS_BUCKET_NAME | COS Bucket | `bucket-xxxx` |

> 未配置 COS 相关变量会导致上传功能不可用。

## 4. 后端启动

- 模块入口：`recipe-platform/recipe-web`
- 端口：默认 `8080`

开发启动（示例）：

```bash
mvn -pl recipe-web -am spring-boot:run
```

打包运行（示例）：

```bash
mvn -pl recipe-web -am package
java -jar recipe-platform/recipe-web/target/recipe-web-1.0-SNAPSHOT.jar
```

## 5. 前端启动

- 前端目录：`recipe-ui`
- 开发端口：默认 `5173`

```bash
npm install
npm run dev
```

代理配置：
- `/api` -> `http://localhost:8080`
- `/ws` -> `ws://localhost:8080`

## 6. WebSocket

- 地址：`ws://localhost:8080/ws?token=...`
- 前端通过代理访问：`/ws?token=...`

## 7. 常见问题排查

- 401/403：检查 Token 是否携带、角色是否正确（管理员接口只允许 `admin`）。
- 409：账号已在线，需要调用强制登录接口。
- 413：上传文件超过 50MB 限制。
- 500：检查 `.env` 中数据库/Redis/COS 配置是否缺失。
