# 用户与认证

本模块覆盖验证码、注册登录、用户资料、密码修改、退出登录与 Token 机制。

## 1. 认证机制概览

- 认证方式：JWT Bearer Token。
- Token 载荷：`userId` / `username` / `role`。
- 请求头格式：`Authorization: Bearer <token>`。
- 退出登录：Token 加入 Redis 黑名单。

## 2. 验证码

- 接口：`GET /api/v1/captcha`
- 权限：公开
- 返回：`captchaId` 与 `imageBase64`
- 说明：验证码有效期 5 分钟，校验后立即失效。

## 3. 用户注册

- 接口：`POST /api/v1/users/register`
- 权限：公开（限流：60 秒 3 次，按 IP）
- 请求字段：
  - `username` 账号
  - `password` 密码
  - `nickname` 昵称
  - `captchaId` 验证码 ID
  - `captchaCode` 验证码内容
- 说明：注册成功后角色为 `member`。

## 4. 用户登录

- 接口：`POST /api/v1/users/login`
- 权限：公开（限流：60 秒 5 次，按 IP）
- 请求字段：同注册验证码字段 + 用户名密码
- 返回：Token 与用户基础信息（`userId`/`nickname`/`role`/`avatar`）
- 冲突处理：当检测到账号已在线时返回冲突状态并提示确认登录。

## 5. 强制登录

- 接口：`POST /api/v1/users/force-login`
- 权限：公开（限流：60 秒 5 次，按 IP）
- 说明：踢掉旧会话后重新发放 Token。

## 6. 获取与更新个人资料

- 接口：
  - `GET /api/v1/users/me`
  - `PUT /api/v1/users/me`
- 权限：登录用户
- 更新字段：`nickname` / `avatar` / `intro`

## 7. 修改密码

- 接口：`PUT /api/v1/users/password`
- 权限：登录用户
- 请求字段：`oldPassword` / `newPassword`

## 8. 退出登录

- 接口：`POST /api/v1/users/logout`
- 权限：登录用户
- 说明：将当前 Token 的 `jti` 写入 Redis 黑名单。

## 9. 角色与状态

- 角色：`admin` / `common_admin` / `member`。
- 状态：`1` 正常、`0` 封禁（数据库默认正常）。
- 注意：当前安全配置仅允许 `admin` 角色访问后台接口。
