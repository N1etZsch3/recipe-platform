# 后端功能总览

本文档基于当前代码仓库实际实现整理，覆盖后端模块职责、核心业务功能、权限边界与基础设施能力，作为后续详细功能文档的总览入口。

## 1. 项目结构与模块边界

- `recipe-common`：通用能力（统一返回、常量、枚举、JWT、线程上下文、工具类）。
- `recipe-framework`：基础设施（安全配置、JWT 过滤器、Redis/缓存、AOP 限流与幂等、WebSocket、COS 上传、异常处理）。
- `recipe-system`：用户域（注册登录、验证码、用户资料与密码、用户缓存）。
- `recipe-business`：业务域（菜谱、互动、社交、管理后台、通知推送、数据统计）。
- `recipe-web`：HTTP API（控制器与应用启动入口）。

## 2. 角色与访问边界

- 游客：可访问公开接口（菜谱列表/详情、评论列表、验证码、登录/注册）。
- 登录用户：除公开接口外的业务接口（发布菜谱、互动、社交、个人中心等）。
- 管理员：`/api/v1/admin/**` 接口，当前安全配置仅允许 `admin` 角色访问。

## 3. 功能概览（后端维度）

### 3.1 用户与认证
- 图形验证码生成与校验。
- 用户注册/登录/强制登录（踢掉已在线会话）。
- 用户资料获取与更新、密码修改、退出登录（Token 黑名单）。

### 3.2 菜谱核心
- 菜谱发布/修改/删除/下架。
- 菜谱分页查询、详情查询、分类列表。
- 菜谱状态流转：待审核 → 已发布 / 驳回；已发布不可直接修改。

### 3.3 互动与评论
- 收藏/取消收藏。
- 评论与回复、点赞/取消点赞。
- 我的评论、回复我的评论、收到的点赞等信息中心接口。

### 3.4 社交与私信
- 关注/取关、粉丝与关注列表。
- 私信聊天、会话列表、消息已读标记。
- 非互关情况下仅允许发送一条消息。

### 3.5 管理后台
- 管理员登录。
- 仪表盘统计数据（用户/菜谱/评论/分类等）。
- 菜谱审核、批量审核、批量上架/下架。
- 分类管理、用户管理、评论管理。
- 操作日志记录与查询、在线状态查询/踢下线。

### 3.6 系统能力
- JWT 鉴权 + Token 黑名单。
- Redis 缓存（分类、仪表盘、用户、菜谱等）与定时预热。
- AOP 限流与幂等控制。
- WebSocket 通知推送（评论、关注、私信、审核通知）。
- COS 文件上传。
- 全局异常处理与统一返回。

## 4. 关键业务流程

- 登录流程：验证码校验 → 账号校验 → 密码校验 → 生成 Token → 返回用户信息。
- 发布菜谱：提交后进入待审核 → 管理员审核 → 通过发布或驳回反馈。
- 评论与通知：评论/回复/点赞触发 WebSocket 通知（在线用户）。
- 私信限制：未互关时仅允许发送一条消息。

## 5. 当前实现的限制/注意点

- `common_admin` 角色可登录后台，但安全配置仅放行 `admin` 角色访问后台接口。
- 登录失败锁定能力已实现 `LoginAttemptService`，但尚未接入认证流程。
- `RecipeCacheService` 已实现但未被业务接口调用。
- 系统通知接口目前返回空列表（预留扩展）。

## 6. 相关入口与配置

- 应用入口：`recipe-platform/recipe-web/src/main/java/com/n1etzsch3/recipe/RecipeApplication.java`。
- 运行配置：`recipe-platform/recipe-web/src/main/resources/application.yml`。
- 环境变量：数据库、Redis、JWT、COS 等（详见后续文档）。
